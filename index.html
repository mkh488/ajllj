<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stream Viewer Hub - Multi-Platform Live Streams</title>
    <meta name="description" content="Watch live gaming streams from multiple platforms">
    <meta name="robots" content="noindex, nofollow">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #0e0e10;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            overflow-x: hidden;
        }
        
        .header {
            background: linear-gradient(90deg, #9147ff 0%, #772ce8 100%);
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .header.youtube {
            background: linear-gradient(90deg, #ff0000 0%, #cc0000 100%);
        }
        
        .header.tiktok {
            background: linear-gradient(90deg, #000000 0%, #EE1D52 50%, #69C9D0 100%);
        }
        
        .header h1 {
            color: white;
            font-size: 1.5em;
            font-weight: 600;
        }
        
        .status {
            color: rgba(255,255,255,0.8);
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .main-player {
            flex: 1;
            position: relative;
            background: #18181b;
            min-height: 500px;
        }
        
        .player-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        #streamEmbed {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .info-bar {
            background: #1f1f23;
            padding: 15px 20px;
            color: #efeff1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .channel-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .live-indicator {
            background: #eb0400;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
            text-transform: uppercase;
            animation: pulse 2s infinite;
        }
        
        .live-indicator.youtube {
            background: #ff0000;
        }
        
        .live-indicator.tiktok {
            background: #EE1D52;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .channel-name {
            font-size: 1.1em;
            font-weight: 600;
            color: #bf94ff;
        }
        
        .channel-name.youtube {
            color: #ff0000;
        }
        
        .channel-name.tiktok {
            color: #EE1D52;
        }
        
        .platform-badge {
            background: #9147ff;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .platform-badge.youtube {
            background: #ff0000;
        }
        
        .platform-badge.tiktok {
            background: #000000;
        }
        
        .viewer-count {
            color: #adadb8;
            font-size: 0.9em;
        }
        
        .viewer-count span {
            color: #efeff1;
            font-weight: 600;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            color: #adadb8;
            font-size: 0.9em;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .stat-value {
            color: #efeff1;
            font-weight: 600;
        }
        
        /* Loading animation */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #adadb8;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid #1f1f23;
            border-top-color: #9147ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Error state */
        .error {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #adadb8;
            padding: 20px;
        }
        
        .error h2 {
            color: #efeff1;
            margin-bottom: 10px;
        }
        
        /* Mobile responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.2em;
            }
            
            .info-bar {
                padding: 10px 15px;
            }
            
            .stats {
                display: none;
            }
            
            .main-player {
                min-height: 300px;
            }
        }
        
        /* Hide scrollbar but keep functionality */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1f1f23;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #464649;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #5a5a5d;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header" id="header">
            <h1>🎮 Multi-Platform Stream Hub</h1>
            <div class="status" id="status">Initializing stream...</div>
        </div>
        
        <div class="main-player">
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <div>Loading stream...</div>
            </div>
            
            <div class="player-wrapper" id="playerWrapper" style="display: none;">
                <iframe
                    id="streamEmbed"
                    src=""
                    frameborder="0"
                    allowfullscreen="true"
                    scrolling="no"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
                </iframe>
            </div>
            
            <div class="error" id="error" style="display: none;">
                <h2>Stream Unavailable</h2>
                <p>The stream could not be loaded. Please check the channel name and try again.</p>
            </div>
        </div>
        
        <div class="info-bar">
            <div class="channel-info">
                <div class="live-indicator" id="liveIndicator">LIVE</div>
                <span class="platform-badge" id="platformBadge">PLATFORM</span>
                <div class="channel-name" id="channelName">Loading...</div>
                <div class="viewer-count">
                    Viewers: <span id="viewerCount">--</span>
                </div>
            </div>
            
            <div class="stats">
                <div class="stat-item">
                    <span>Quality:</span>
                    <span class="stat-value" id="quality">Auto</span>
                </div>
                <div class="stat-item">
                    <span>Uptime:</span>
                    <span class="stat-value" id="uptime">00:00</span>
                </div>
                <div class="stat-item">
                    <span>Status:</span>
                    <span class="stat-value" id="streamStatus">Connected</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const config = {
            defaultChannel: 'monstercat',
            defaultPlatform: 'twitch',
            loadTimeout: 10000,
            statsUpdateInterval: 1000,
            viewerCountVariation: true,
            autoQuality: true,
            muteByDefault: true
        };
        
        // Get parameters from URL
        const params = new URLSearchParams(window.location.search);
        
        // ========================================
        // 🎯 PARAMETRI PRINCIPALI - MODIFICA QUI!
        // ========================================
        const platform = params.get('platform') || config.defaultPlatform; // 'twitch', 'youtube', 'tiktok'
        const channel = params.get('channel') || params.get('videoId') || config.defaultChannel;
        const videoId = params.get('videoId') || params.get('v'); // Per YouTube video ID
        const muted = params.get('muted') !== 'false';
        const autoplay = params.get('autoplay') !== 'false';
        const controls = params.get('controls') !== 'false';
        const layout = params.get('layout') || 'video';
        
        // Get parent domain (CRITICAL for Twitch embed)
        const parentDomain = window.location.hostname;
        
        // State
        let startTime = Date.now();
        let isLoaded = false;
        let viewerBase = Math.floor(Math.random() * 5000) + 1000;
        
        // ========================================
        // 🔥 FUNZIONE PRINCIPALE - GENERA EMBED URL
        // ========================================
        function getEmbedUrl(platform, channelOrVideoId) {
            let embedUrl = '';
            
            switch(platform.toLowerCase()) {
                // ========================================
                // TWITCH EMBED
                // ========================================
                case 'twitch':
                    const twitchParams = new URLSearchParams({
                        channel: channelOrVideoId,
                        parent: parentDomain,
                        muted: muted,
                        autoplay: autoplay,
                        controls: controls,
                        layout: layout,
                        theme: 'dark',
                        width: '100%',
                        height: '100%'
                    });
                    embedUrl = `https://player.twitch.tv/?${twitchParams.toString()}`;
                    break;
                
                // ========================================
                // YOUTUBE EMBED
                // ========================================
                case 'youtube':
                    // Supporta sia video ID che live streams
                    let ytVideoId = videoId || channelOrVideoId;
                    
                    // Se è un URL completo, estrai l'ID
                    if (ytVideoId.includes('youtube.com') || ytVideoId.includes('youtu.be')) {
                        const ytMatch = ytVideoId.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/);
                        if (ytMatch) ytVideoId = ytMatch[1];
                    }
                    
                    const ytParams = new URLSearchParams({
                        autoplay: autoplay ? '1' : '0',
                        mute: muted ? '1' : '0',
                        controls: controls ? '1' : '0',
                        modestbranding: '1',
                        rel: '0',
                        showinfo: '0',
                        iv_load_policy: '3',
                        enablejsapi: '1',
                        origin: window.location.origin
                    });
                    
                    // Per live stream di un canale specifico
                    if (channelOrVideoId.startsWith('@') || channelOrVideoId.startsWith('UC')) {
                        embedUrl = `https://www.youtube.com/embed/live_stream?channel=${channelOrVideoId}&${ytParams.toString()}`;
                    } else {
                        embedUrl = `https://www.youtube.com/embed/${ytVideoId}?${ytParams.toString()}`;
                    }
                    break;
                
                // ========================================
                // TIKTOK EMBED (PIÙ LIMITATO)
                // ========================================
                case 'tiktok':
                    // TikTok non ha un embed ufficiale per le live
                    // Opzione 1: Usa l'URL diretto (potrebbe non funzionare in iframe)
                    let tiktokUser = channelOrVideoId;
                    
                    // Rimuovi @ se presente
                    if (tiktokUser.startsWith('@')) {
                        tiktokUser = tiktokUser.substring(1);
                    }
                    
                    // Per live TikTok (metodo sperimentale)
                    embedUrl = `https://www.tiktok.com/@${tiktokUser}/live`;
                    
                    // Alternativa: Usa un iframe wrapper
                    // embedUrl = `https://www.tiktok.com/embed/v2/${videoId}`;
                    
                    console.warn('TikTok live embed è limitato. Potrebbe non funzionare correttamente in iframe.');
                    break;
                
                default:
                    console.error('Platform not supported:', platform);
                    return null;
            }
            
            return embedUrl;
        }
        
        // ========================================
        // INIZIALIZZA EMBED
        // ========================================
        function initializeEmbed() {
            try {
                // Update UI based on platform
                updateUIForPlatform(platform);
                
                // Update channel/video info
                document.getElementById('channelName').textContent = channel;
                document.getElementById('status').textContent = `Connecting to ${channel}...`;
                
                // ========================================
                // 🎯 QUI VIENE GENERATO L'URL DELL'EMBED!
                // ========================================
                const embedUrl = getEmbedUrl(platform, channel);
                
                if (!embedUrl) {
                    showError();
                    return;
                }
                
                console.log('Loading embed:', embedUrl);
                
                // Set iframe source
                const iframe = document.getElementById('streamEmbed');
                iframe.src = embedUrl;
                
                // Special handling for TikTok
                if (platform.toLowerCase() === 'tiktok') {
                    // TikTok potrebbe bloccare iframe, proviamo alternative
                    iframe.sandbox = 'allow-scripts allow-same-origin allow-popups allow-forms';
                }
                
                // Handle load success
                iframe.onload = function() {
                    setTimeout(() => {
                        document.getElementById('loading').style.display = 'none';
                        document.getElementById('playerWrapper').style.display = 'block';
                        document.getElementById('status').textContent = `Watching: ${channel}`;
                        document.getElementById('streamStatus').textContent = 'Connected';
                        isLoaded = true;
                        
                        // Start stats updates
                        startStatsUpdates();
                        
                        // Log success
                        console.log('Stream loaded successfully:', {
                            platform: platform,
                            channel: channel,
                            url: embedUrl
                        });
                    }, 1000);
                };
                
                // Handle iframe errors
                iframe.onerror = function(e) {
                    console.error('Iframe load error:', e);
                    if (platform.toLowerCase() === 'tiktok') {
                        // Fallback per TikTok: apri in nuova finestra
                        console.log('TikTok iframe failed, trying direct navigation...');
                        window.location.href = embedUrl;
                    } else {
                        showError();
                    }
                };
                
                // Handle load timeout
                setTimeout(() => {
                    if (!isLoaded) {
                        showError();
                    }
                }, config.loadTimeout);
                
            } catch (error) {
                console.error('Embed initialization error:', error);
                showError();
            }
        }
        
        // Update UI for different platforms
        function updateUIForPlatform(platform) {
            const header = document.getElementById('header');
            const liveIndicator = document.getElementById('liveIndicator');
            const channelName = document.getElementById('channelName');
            const platformBadge = document.getElementById('platformBadge');
            
            // Remove all platform classes
            header.className = 'header';
            liveIndicator.className = 'live-indicator';
            channelName.className = 'channel-name';
            platformBadge.className = 'platform-badge';
            
            // Add platform-specific classes
            switch(platform.toLowerCase()) {
                case 'youtube':
                    header.classList.add('youtube');
                    liveIndicator.classList.add('youtube');
                    channelName.classList.add('youtube');
                    platformBadge.classList.add('youtube');
                    platformBadge.textContent = 'YOUTUBE';
                    document.querySelector('.header h1').textContent = '📺 YouTube Stream Hub';
                    break;
                
                case 'tiktok':
                    header.classList.add('tiktok');
                    liveIndicator.classList.add('tiktok');
                    channelName.classList.add('tiktok');
                    platformBadge.classList.add('tiktok');
                    platformBadge.textContent = 'TIKTOK';
                    document.querySelector('.header h1').textContent = '🎵 TikTok Stream Hub';
                    break;
                
                default: // Twitch
                    platformBadge.textContent = 'TWITCH';
                    document.querySelector('.header h1').textContent = '🎮 Twitch Stream Hub';
                    break;
            }
        }
        
        // Show error state
        function showError() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('playerWrapper').style.display = 'none';
            document.getElementById('error').style.display = 'block';
            document.getElementById('status').textContent = 'Stream unavailable';
            document.getElementById('streamStatus').textContent = 'Disconnected';
        }
        
        // Update statistics
        function startStatsUpdates() {
            setInterval(() => {
                // Update uptime
                const elapsed = Date.now() - startTime;
                const minutes = Math.floor(elapsed / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);
                document.getElementById('uptime').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Update viewer count (with variation)
                if (config.viewerCountVariation) {
                    const variation = Math.floor(Math.random() * 200) - 100;
                    const viewers = Math.max(1, viewerBase + variation);
                    document.getElementById('viewerCount').textContent = viewers.toLocaleString();
                }
                
                // Simulate quality changes
                if (Math.random() < 0.01) {
                    const qualities = platform === 'youtube' 
                        ? ['1080p', '720p', '480p', '360p', '144p', 'Auto']
                        : ['1080p60', '720p60', '720p', '480p', '360p', 'Auto'];
                    document.getElementById('quality').textContent = 
                        qualities[Math.floor(Math.random() * qualities.length)];
                }
            }, config.statsUpdateInterval);
        }
        
        // Simulate human behavior
        function simulateActivity() {
            // Random micro-scrolls
            setInterval(() => {
                if (Math.random() < 0.1) {
                    window.scrollBy(0, Math.random() * 2 - 1);
                }
            }, 5000);
            
            // Random focus events
            setInterval(() => {
                if (Math.random() < 0.05) {
                    window.focus();
                    setTimeout(() => window.blur(), Math.random() * 1000);
                }
            }, 10000);
            
            // Simulate page visibility changes
            document.addEventListener('visibilitychange', function() {
                console.log('Visibility changed:', document.visibilityState);
            });
        }
        
        // Handle errors
        window.addEventListener('error', function(e) {
            console.error('Global error:', e);
        });
        
        // Prevent iframe breaking out
        if (window.top !== window.self) {
            window.top.location = window.self.location;
        }
        
        // Initialize when ready
        document.addEventListener('DOMContentLoaded', function() {
            initializeEmbed();
            simulateActivity();
            
            // Add some metadata for legitimacy
            document.title = `${channel} - ${platform} Stream Hub`;
            
            // Log page lifecycle
            console.log('Page initialized:', {
                platform: platform,
                channel: channel,
                parent: parentDomain,
                timestamp: new Date().toISOString()
            });
        });
        
        // Handle page unload
        window.addEventListener('beforeunload', function() {
            console.log('Stream session ended:', {
                platform: platform,
                channel: channel,
                duration: Date.now() - startTime
            });
        });
        
        // ========================================
        // 📝 ESEMPI DI URL DA USARE:
        // ========================================
        /*
        TWITCH:
        - tuosito.com?platform=twitch&channel=shroud
        - tuosito.com?platform=twitch&channel=pokimane
        
        YOUTUBE:
        - tuosito.com?platform=youtube&videoId=jfKfPfyJRdk  (lofi girl live)
        - tuosito.com?platform=youtube&channel=UC_x5XG1OV2P6uZZ5FSM9Ttw (NASA live)
        - tuosito.com?platform=youtube&videoId=VIDEO_ID_HERE
        
        TIKTOK:
        - tuosito.com?platform=tiktok&channel=khaby.lame
        - tuosito.com?platform=tiktok&channel=charlidamelio
        
        CON PARAMETRI EXTRA:
        - &muted=false (per non mutare)
        - &autoplay=false (per non avviare automaticamente)
        - &controls=false (per nascondere controlli)
        */
    </script>
</body>
</html>
